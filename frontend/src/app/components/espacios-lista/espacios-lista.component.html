<!-- Toast para notificaciones -->
<p-toast></p-toast>

<!-- Contenedor principal -->
<div class="espacios-container">
  
  <!-- Card de filtros -->
  <p-card class="filtros-card">
    <!-- Header del card de filtros -->
    <ng-template pTemplate="header">
      <h2 class="filtros-titulo">BUSCAR ESPACIOS</h2>
    </ng-template>

    <!-- Formulario de filtros -->
    <div class="filtros-grid">
      
      <!-- Filtro por tipo -->
      <div class="filtro-item">
        <label for="tipo">TIPO DE ESPACIO</label>
        <p-dropdown 
          [(ngModel)]="filtros.tipo"
          [options]="tiposEspacio"
          placeholder="Todos los tipos"
          [showClear]="true"
          optionLabel="label"
          optionValue="value"
        ></p-dropdown>
      </div>

      <!-- Filtro por capacidad -->
      <div class="filtro-item">
        <label for="capacidad">CAPACIDAD MÍNIMA</label>
        <input 
          type="number" 
          pInputText 
          [(ngModel)]="filtros.capacidad_minima"
          placeholder="Ej: 20"
          min="1"
        />
      </div>

      <!-- Filtro por disponibilidad -->
      <div class="filtro-item">
        <label for="disponible">DISPONIBILIDAD</label>
        <p-dropdown 
          [(ngModel)]="filtros.disponible"
          [options]="opcionesDisponibilidad"
          placeholder="Todos"
          [showClear]="true"
          optionLabel="label"
          optionValue="value"
        ></p-dropdown>
      </div>

      <!-- Botones de acción -->
      <div class="filtro-acciones">
        <p-button 
          label="Buscar"
          icon="pi pi-search"
          (onClick)="aplicarFiltros()"
        ></p-button>
        <p-button 
          label="Limpiar"
          icon="pi pi-times"
          (onClick)="limpiarFiltros()"
          severity="secondary"
          [outlined]="true"
        ></p-button>
      </div>
    </div>
  </p-card>

  <!-- Indicador de carga -->
  <div *ngIf="cargando" class="loading-container">
    <i class="pi pi-spin pi-spinner"></i>
    <p>Cargando espacios...</p>
  </div>

  <!-- Grid de espacios -->
  <div *ngIf="!cargando" class="espacios-grid">
    <p-card *ngFor="let espacio of espacios" class="espacio-card">
      
      <!-- Imagen del espacio -->
      <ng-template pTemplate="header">
        <div class="card-image-wrapper">
          <img [src]="espacio.imagen_url" [alt]="espacio.nombre" class="card-image">
          <p-tag 
            [value]="espacio.disponible ? 'Disponible' : 'No disponible'"
            [severity]="espacio.disponible ? 'success' : 'danger'"
            styleClass="disponibilidad-tag"
          ></p-tag>
        </div>
      </ng-template>

      <!-- Contenido de la tarjeta -->
      <h3 class="espacio-nombre">{{ espacio.nombre }}</h3>
      <p class="espacio-descripcion">{{ espacio.descripcion }}</p>

      <!-- Información del espacio -->
      <div class="espacio-info">
        <div class="info-badge">
          <i class="pi pi-tag"></i>
          <span>{{ espacio.tipo }}</span>
        </div>
        <div class="info-badge">
          <i class="pi pi-users"></i>
          <span>{{ espacio.capacidad }} personas</span>
        </div>
      </div>

      <!-- Botones de la tarjeta -->
      <ng-template pTemplate="footer">
        <div class="card-footer-buttons">
          <p-button 
            label="Ver Detalle"
            icon="pi pi-eye"
            (onClick)="verDetalle(espacio)"
            [outlined]="true"
            severity="secondary"
            styleClass="btn-detalle"
          ></p-button>
          <p-button 
            label="Reservar"
            icon="pi pi-calendar-plus"
            (onClick)="abrirModalReserva(espacio)"
            [disabled]="!espacio.disponible"
            styleClass="btn-reservar-card"
          ></p-button>
        </div>
      </ng-template>
    </p-card>
  </div>

  <!-- Mensaje cuando no hay espacios -->
  <div *ngIf="!cargando && espacios.length === 0" class="empty-state">
    <i class="pi pi-inbox"></i>
    <h3>No se encontraron espacios</h3>
    <p>Intenta ajustar los filtros de búsqueda</p>
  </div>
</div>

<!-- Modal para reservar -->
<p-dialog 
  [header]="'Reservar: ' + (espacioSeleccionado?.nombre || '')"
  [(visible)]="mostrarModalReserva"
  [modal]="true"
  [breakpoints]="{'960px': '90vw'}"
  [style]="{width: '600px'}"
  [contentStyle]="{overflow: 'visible', 'min-height': '500px'}"
  [draggable]="false"
  [resizable]="false"
  [dismissableMask]="true"
  styleClass="modal-reserva"
>
  <div class="modal-body-reserva">
    
    <!-- Campo: Nombre del evento -->
    <div class="p-field mb-3">
      <label for="nombreEvento">NOMBRE DEL EVENTO</label>
      <input 
        type="text"
        pInputText 
        id="nombreEvento" 
        [(ngModel)]="nombreEvento"
        placeholder="Ej: Reunión de Equipo"
        class="w-full"
      />
    </div>

    <!-- Campo: Fecha y hora de inicio -->
    <div class="p-field mb-3">
      <label for="fechaInicio">FECHA Y HORA DE INICIO</label>
      <p-calendar 
        [(ngModel)]="fechaInicio"
        [showTime]="true"
        [showSeconds]="true"
        [minDate]="fechaMinima"
        placeholder="Seleccione fecha y hora"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        iconDisplay="input"
        [appendTo]="'body'"
        styleClass="w-full"
        inputStyleClass="w-full"
      ></p-calendar>
    </div>

    <!-- Campo: Fecha y hora de fin -->
    <div class="p-field">
      <label for="fechaFin">FECHA Y HORA DE FIN</label>
      <p-calendar 
        [(ngModel)]="fechaFin"
        [showTime]="true"
        [showSeconds]="true"
        [minDate]="fechaInicio || fechaMinima"
        placeholder="Seleccione fecha y hora"
        dateFormat="dd/mm/yy"
        [showIcon]="true"
        iconDisplay="input"
        [appendTo]="'body'"
        styleClass="w-full"
        inputStyleClass="w-full"
      ></p-calendar>
    </div>
  </div>

  <!-- Botones del modal -->
  <ng-template pTemplate="footer">
    <p-button 
      label="Cancelar"
      icon="pi pi-times"
      (onClick)="cerrarModal()"
      severity="secondary"
      [outlined]="true"
    ></p-button>
    <p-button 
      label="Confirmar Reserva"
      icon="pi pi-check"
      (onClick)="crearReserva()"
      [loading]="cargandoReserva"
    ></p-button>
  </ng-template>
</p-dialog>